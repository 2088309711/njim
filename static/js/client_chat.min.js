!function(){var d=[],n="",i=true,g=false,u=false,a="",p="",v="",f="";$(function(){var w=$("#data");a=w.attr("staff_id");p=w.attr("staff_name");v=w.attr("client_id");f=w.attr("access");u=!!navigator.userAgent.match(/(iPhone|iPod|Android|ios)/i);m();$("#send").click(o);$("#edit").keydown(function(x){if(x.ctrlKey&&x.which==13){o()}});$("#open-emo-panel").click(function(){$("#emo-panel").show();g=true});$("#emo-box>img").click(function(){$("#edit").val($("#edit").val()+$(this).attr("title"))});$("#close-emo-panel").click(r);$("#show-message").click(r);$("#edit").click(r)});var l=new Vue({el:"#show-message",data:{messages:[],outMsgCount:0},methods:{add:function(z){for(var x=0;x<this.messages.length;x++){if(this.messages[x].id===z.id){return}}this.messages.push(z);var y=new k();for(var x=0;x<this.messages.length;x++){y.insert(this.messages[x])}var w=[];y.inOrderTraverse(function(A){w.push(A)});this.messages=w;this.$nextTick(function(){var A=$("#show-message");A.scrollTop(A[0].scrollHeight)})},display_time:function(){this.outMsgCount++;return this.outMsgCount%3==0}}});function k(){var x=function(A){this.key=A;this.left=null;this.right=null};var w=null;var y=function(B,A){if(A.key.id<B.key.id){if(B.left===null){B.left=A}else{y(B.left,A)}}else{if(B.right===null){B.right=A}else{y(B.right,A)}}};this.insert=function(B){var A=new x(B);if(w===null){w=A}else{y(w,A)}};var z=function(A,B){if(A!==null){z(A.left,B);B(A.key);z(A.right,B)}};this.inOrderTraverse=function(A){z(w,A)}}function r(){if(g){$("#emo-panel").hide();g=false}}function m(){l.add({id:-2,type:2,content:"系统："+p+"为您服务",time:""})}function o(){r();var x=c();if(x==""||a.length<5||a.length>14||v.length!=40){return}b();var w=e(x);$.post("/index.php/client/message/send",{staff_id:a,client_id:v,content:w})}setInterval(q,1000);function q(){if(a.length<5||a.length>14||v.length!=40){return}var w="n";if(i){w="o";i=false}$.ajax({url:"/index.php/client/message/get/s/"+a+"/c/"+v+"/t/"+w+"/b/"+t(),type:"GET",dataType:"json",success:function(x){j(x)}})}function j(x){d=[];if(x==null||x.length==0){return}for(var w=0;w<x.length;w++){d.push(x[w].id);var y=x[w].send_time.split(" ");l.add({id:parseInt(x[w].id),type:x[w].send_type,content:x[w].content,time:y[1]})}}function t(){var x="";for(var w=0;w<d.length;w++){x+=d[w];if(w!=d.length-1){x+=":"}}return x}function c(){return $.trim($("#edit").val())}function b(){n=c();$("#edit").val("")}function h(w){console.log(w)}function e(y){var x=[["\n","<br>"],["\\[微笑]",'<img src="/static/images/emo/emo_13.gif" />'],["\\[可怜]",'<img src="/static/images/emo/emo_17.gif" />'],["\\[大笑]",'<img src="/static/images/emo/emo_15.gif" />'],["\\[调皮]",'<img src="/static/images/emo/emo_21.gif" />'],["\\[饥饿]",'<img src="/static/images/emo/emo_41.gif" />'],["\\[再见]",'<img src="/static/images/emo/emo_42.gif" />'],["\\[互粉]",'<img src="/static/images/emo/emo_11.gif" />'],["\\[鼓掌]",'<img src="/static/images/emo/emo_52.gif" />'],["\\[呲牙]",'<img src="/static/images/emo/emo_14.gif" />'],["\\[可爱]",'<img src="/static/images/emo/emo_16.gif" />'],["\\[害羞]",'<img src="/static/images/emo/emo_20.gif" />'],["\\[闭嘴]",'<img src="/static/images/emo/emo_22.gif" />'],["\\[鄙视]",'<img src="/static/images/emo/emo_23.gif" />'],["\\[示爱]",'<img src="/static/images/emo/emo_24.gif" />'],["\\[大哭]",'<img src="/static/images/emo/emo_25.gif" />'],["\\[偷笑]",'<img src="/static/images/emo/emo_26.gif" />'],["\\[亲亲]",'<img src="/static/images/emo/emo_27.gif" />'],["\\[冷]",'<img src="/static/images/emo/emo_28.gif" />'],["\\[敲打]",'<img src="/static/images/emo/emo_29.gif" />'],["\\[惊讶]",'<img src="/static/images/emo/emo_30.gif" />'],["\\[左哼哼]",'<img src="/static/images/emo/emo_32.gif" />'],["\\[右哼哼]",'<img src="/static/images/emo/emo_31.gif" />'],["\\[嘘]",'<img src="/static/images/emo/emo_33.gif" />'],["\\[衰]",'<img src="/static/images/emo/emo_34.gif" />'],["\\[委屈]",'<img src="/static/images/emo/emo_35.gif" />'],["\\[吐]",'<img src="/static/images/emo/emo_36.gif" />'],["\\[困]",'<img src="/static/images/emo/emo_37.gif" />'],["\\[快乐]",'<img src="/static/images/emo/emo_38.gif" />'],["\\[怒]",'<img src="/static/images/emo/emo_39.gif" />'],["\\[疑问]",'<img src="/static/images/emo/emo_40.gif" />'],["\\[爆筋]",'<img src="/static/images/emo/emo_51.gif" />'],["\\[晕]",'<img src="/static/images/emo/emo_53.gif" />'],["\\[快哭了]",'<img src="/static/images/emo/emo_54.gif" />'],["\\[抓狂]",'<img src="/static/images/emo/emo_55.gif" />'],["\\[尴尬]",'<img src="/static/images/emo/emo_56.gif" />'],["\\[阴险]",'<img src="/static/images/emo/emo_57.gif" />'],["\\[骂]",'<img src="/static/images/emo/emo_58.gif" />'],["\\[爱心]",'<img src="/static/images/emo/emo_59.gif" />'],["\\[心碎]",'<img src="/static/images/emo/emo_60.gif" />'],["\\[抠鼻]",'<img src="/static/images/emo/emo_18.gif" />'],["\\[惊]",'<img src="/static/images/emo/emo_19.gif" />'],["\\[考虑]",'<img src="/static/images/emo/emo_43.gif" />'],["\\[流汗]",'<img src="/static/images/emo/emo_44.gif" />'],["\\[哈欠]",'<img src="/static/images/emo/emo_45.gif" />'],["\\[睡觉]",'<img src="/static/images/emo/emo_46.gif" />'],["\\[贪财]",'<img src="/static/images/emo/emo_47.gif" />'],["\\[无奈]",'<img src="/static/images/emo/emo_48.gif" />'],["\\[得意]",'<img src="/static/images/emo/emo_49.gif" />'],["\\[色]",'<img src="/static/images/emo/emo_50.gif" />'],["\\[礼物]",'<img src="/static/images/emo/emo_12.gif" />'],["\\[狗]",'<img src="/static/images/emo/emo_01.gif" />'],["\\[神马]",'<img src="/static/images/emo/emo_02.gif" />'],["\\[云]",'<img src="/static/images/emo/emo_03.gif" />'],["\\[给力]",'<img src="/static/images/emo/emo_04.gif" />'],["\\[团结]",'<img src="/static/images/emo/emo_05.gif" />'],["\\[大V]",'<img src="/static/images/emo/emo_06.gif" />'],["\\[熊猫]",'<img src="/static/images/emo/emo_07.gif" />'],["\\[兔]",'<img src="/static/images/emo/emo_08.gif" />'],["\\[奥特曼]",'<img src="/static/images/emo/emo_09.gif" />'],["\\[囧]",'<img src="/static/images/emo/emo_10.gif" />']];for(var w=0;w<x.length;w++){y=y.replace(new RegExp(x[w][0],"g"),x[w][1])}return y}setInterval(function(){s()},1000);function s(){var x=$(window).height();var w=$(document).height();var y=(x<w?x:w)-124;$("#show-message").css("height",y+"px")}}();